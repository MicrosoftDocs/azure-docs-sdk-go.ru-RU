---
title: Аутентификация с помощью пакета Azure SDK для Go
description: Сведения о методах аутентификации, доступных в пакете Azure SDK для Go, и способах их использования.
services: azure
author: sptramer
ms.author: sttramer
manager: carmonm
ms.date: 09/05/2018
ms.topic: conceptual
ms.technology: azure-sdk-go
ms.devlang: go
ms.service: active-directory
ms.component: authentication
ms.openlocfilehash: 8f94b9ba715c32263d324306cce69bd484c05702
ms.sourcegitcommit: c435f6602524565d340aac5506be5e955e78f16c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/12/2018
ms.locfileid: "44711980"
---
# <a name="authentication-methods-in-the-azure-sdk-for-go"></a><span data-ttu-id="b7e64-103">Методы аутентификации в пакете Azure SDK для Go</span><span class="sxs-lookup"><span data-stu-id="b7e64-103">Authentication methods in the Azure SDK for Go</span></span>

<span data-ttu-id="b7e64-104">Пакет Azure SDK для Go предлагает несколько способов аутентификации в Azure.</span><span class="sxs-lookup"><span data-stu-id="b7e64-104">The Azure SDK for Go offers multiple ways to authenticate with Azure.</span></span> <span data-ttu-id="b7e64-105">Эти _типы_ аутентификации вызываются с помощью разных _методов_ аутентификации.</span><span class="sxs-lookup"><span data-stu-id="b7e64-105">These authentication _types_ are invoked through different authentication _methods_.</span></span> <span data-ttu-id="b7e64-106">В этой статье рассматриваются доступные типы и методы, а также способы их определения для вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="b7e64-106">This article covers the available types, methods, and how to choose which are best for your application.</span></span>

## <a name="available-authentication-types-and-methods"></a><span data-ttu-id="b7e64-107">Доступные типы и методы аутентификации</span><span class="sxs-lookup"><span data-stu-id="b7e64-107">Available authentication types and methods</span></span>

<span data-ttu-id="b7e64-108">В пакете Azure SDK для Go предоставляется несколько типов аутентификации с применением разных наборов учетных данных.</span><span class="sxs-lookup"><span data-stu-id="b7e64-108">The Azure SDK for Go offers several different types of authentication, using different credentials sets.</span></span> <span data-ttu-id="b7e64-109">Для каждого из этих типов используются разные методы аутентификации, определяющие, каким образом пакет SDK принимает эти учетные данные в качестве входных.</span><span class="sxs-lookup"><span data-stu-id="b7e64-109">Each authentication type is available through different authentication methods, which are how the SDK takes these credentials as input.</span></span> <span data-ttu-id="b7e64-110">В приведенной ниже таблице описаны доступные типы аутентификации и ситуации, в которых их рекомендуется использовать в приложении.</span><span class="sxs-lookup"><span data-stu-id="b7e64-110">The following table describes the available types of authentication and situations in which they're recommended for use by your application.</span></span>

| <span data-ttu-id="b7e64-111">Authentication type (Тип проверки подлинности)</span><span class="sxs-lookup"><span data-stu-id="b7e64-111">Authentication type</span></span> | <span data-ttu-id="b7e64-112">Рекомендуется в следующем случае</span><span class="sxs-lookup"><span data-stu-id="b7e64-112">Recommended when...</span></span> |
|---------------------|---------------------|
| <span data-ttu-id="b7e64-113">Аутентификация на основе сертификата</span><span class="sxs-lookup"><span data-stu-id="b7e64-113">Certificate-based authentication</span></span> | <span data-ttu-id="b7e64-114">У вас есть сертификат X509, настроенный для пользователя или субъекта-службы Azure Active Directory (AAD).</span><span class="sxs-lookup"><span data-stu-id="b7e64-114">You have an X509 certificate that was configured for an Azure Active Directory (AAD) user or service principal.</span></span> <span data-ttu-id="b7e64-115">Дополнительные сведения см. в статье [Приступая к работе с аутентификацией на основе сертификата в Azure Active Directory].</span><span class="sxs-lookup"><span data-stu-id="b7e64-115">To learn more, see [Get started with certificate-based authentication in Azure Active Directory].</span></span> |
| <span data-ttu-id="b7e64-116">Учетные данные клиента</span><span class="sxs-lookup"><span data-stu-id="b7e64-116">Client credentials</span></span> | <span data-ttu-id="b7e64-117">У вас есть субъект-служба, настроенный для этого приложения или класса, к которому оно относится.</span><span class="sxs-lookup"><span data-stu-id="b7e64-117">You have a configured service principal that is set up for this application or a class of applications it belongs to.</span></span> <span data-ttu-id="b7e64-118">Дополнительные сведения см. в статье [Создание субъекта-службы с помощью Azure CLI].</span><span class="sxs-lookup"><span data-stu-id="b7e64-118">To learn more, see [Create a service principal with Azure CLI].</span></span> |
| <span data-ttu-id="b7e64-119">Управляемые удостоверения для ресурсов Azure</span><span class="sxs-lookup"><span data-stu-id="b7e64-119">Managed identities for Azure resources</span></span> | <span data-ttu-id="b7e64-120">Приложение выполняется в ресурсе Azure, настроенном для использования управляемого удостоверения.</span><span class="sxs-lookup"><span data-stu-id="b7e64-120">Your application is running on an Azure resource that has been configured with a managed identity.</span></span> <span data-ttu-id="b7e64-121">Дополнительные сведения см. в статье [Управляемые удостоверения для ресурсов Azure].</span><span class="sxs-lookup"><span data-stu-id="b7e64-121">To learn more, see [Managed identities for Azure resources].</span></span> |
| <span data-ttu-id="b7e64-122">Маркер устройства</span><span class="sxs-lookup"><span data-stu-id="b7e64-122">Device token</span></span> | <span data-ttu-id="b7e64-123">Приложение предназначено __только__ для интерактивного использования.</span><span class="sxs-lookup"><span data-stu-id="b7e64-123">Your application is meant to be used interactively __only__.</span></span> <span data-ttu-id="b7e64-124">Пользователи могут использовать включенную многофакторную проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="b7e64-124">Users may have multi-factor authentication enabled.</span></span> <span data-ttu-id="b7e64-125">Пользователям предоставляется доступ к веб-браузеру для входа.</span><span class="sxs-lookup"><span data-stu-id="b7e64-125">Users have access to a web browser to sign in.</span></span> <span data-ttu-id="b7e64-126">Дополнительные сведения см. в разделе об [использовании аутентификации на основе маркера устройства](#use-device-token-authentication).</span><span class="sxs-lookup"><span data-stu-id="b7e64-126">For more information, see [Use device token authentication](#use-device-token-authentication).</span></span>|
| <span data-ttu-id="b7e64-127">Имя пользователя или пароль</span><span class="sxs-lookup"><span data-stu-id="b7e64-127">Username/password</span></span> | <span data-ttu-id="b7e64-128">У вас есть интерактивное приложение, в котором нельзя использовать другой метод аутентификации.</span><span class="sxs-lookup"><span data-stu-id="b7e64-128">You have an interactive application that can't use any other authentication method.</span></span> <span data-ttu-id="b7e64-129">Для пользователей, которые входят с помощью AAD, не включена многофакторная проверка подлинности.</span><span class="sxs-lookup"><span data-stu-id="b7e64-129">Your users don't have multi-factor authentication enabled for their AAD sign-in.</span></span> |

> [!IMPORTANT]
> <span data-ttu-id="b7e64-130">Если используется тип аутентификации, отличный от учетных данных клиента, приложения нужно зарегистрировать в Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="b7e64-130">If you use an authentication type other than client credentials, your application must be registered in Azure Active Directory.</span></span> <span data-ttu-id="b7e64-131">Дополнительные сведения см. в статье [Интеграция приложений с Azure Active Directory](/azure/active-directory/develop/active-directory-integrating-applications).</span><span class="sxs-lookup"><span data-stu-id="b7e64-131">To learn how, see [Integrating applications with Azure Active Directory](/azure/active-directory/develop/active-directory-integrating-applications).</span></span>
>
> [!NOTE]
> <span data-ttu-id="b7e64-132">Если нет особых требований, избегайте проверки пароля или имени пользователя.</span><span class="sxs-lookup"><span data-stu-id="b7e64-132">Unless you have special requirements, avoid username/password authentication.</span></span> <span data-ttu-id="b7e64-133">Если требуется вход на основе учетных данных пользователя, обычно вместо этого можно использовать аутентификацию на основе маркера устройства.</span><span class="sxs-lookup"><span data-stu-id="b7e64-133">In situations where user-based sign in is appropriate, device token authentication can usually be used instead.</span></span>

[Приступая к работе с аутентификацией на основе сертификата в Azure Active Directory]: /azure/active-directory/active-directory-certificate-based-authentication-get-started
[Get started with certificate-based authentication in Azure Active Directory]: /azure/active-directory/active-directory-certificate-based-authentication-get-started
[Создание субъекта-службы с помощью Azure CLI]: /cli/azure/create-an-azure-service-principal-azure-cli
[Create a service principal with Azure CLI]: /cli/azure/create-an-azure-service-principal-azure-cli
[Управляемые удостоверения для ресурсов Azure]: /azure/active-directory/managed-identities-azure-resources/overview
[Managed identities for Azure resources]: /azure/active-directory/managed-identities-azure-resources/overview

<span data-ttu-id="b7e64-137">Для этих типов аутентификации используются разные методы.</span><span class="sxs-lookup"><span data-stu-id="b7e64-137">These authentication types are available through different methods.</span></span>

* <span data-ttu-id="b7e64-138">При [_аутентификации на основе среды_](#use-environment-based-authentication) учетные данные считываются непосредственно из среды программы.</span><span class="sxs-lookup"><span data-stu-id="b7e64-138">[_Environment-based authentication_](#use-environment-based-authentication) reads credentials directly from the program's environment.</span></span>
* <span data-ttu-id="b7e64-139">При [_аутентификации на основе файла_](#use-file-based-authentication) загружается файл, содержащий учетные данные субъекта-службы.</span><span class="sxs-lookup"><span data-stu-id="b7e64-139">[_File-based authentication_](#use-file-based-authentication) loads a file containing service principal credentials.</span></span>
* <span data-ttu-id="b7e64-140">При [_аутентификации на основе клиента_](#use-an-authentication-client) используется объект в коде. При этом вы отвечаете за предоставление учетных данных во время выполнения программы.</span><span class="sxs-lookup"><span data-stu-id="b7e64-140">[_Client-based authentication_](#use-an-authentication-client) uses an object in code and makes you responsible for providing the credentials during program execution.</span></span>
* <span data-ttu-id="b7e64-141">При [_аутентификации на основе маркера устройства_](#use-device-token-authentication) пользователь должен выполнить интерактивный вход через веб-браузер с использованием маркера.</span><span class="sxs-lookup"><span data-stu-id="b7e64-141">[_Device token authentication_](#use-device-token-authentication) requires users to sign in interactively through a web browser with a token.</span></span>

<span data-ttu-id="b7e64-142">Все функции и типы аутентификации доступны в пакете `github.com/Azure/go-autorest/autorest/azure/auth`.</span><span class="sxs-lookup"><span data-stu-id="b7e64-142">All authentication functions and types are available in the `github.com/Azure/go-autorest/autorest/azure/auth` package.</span></span>

> [!NOTE]
> <span data-ttu-id="b7e64-143">Если нет особых требований, избегайте аутентификации на основе клиента.</span><span class="sxs-lookup"><span data-stu-id="b7e64-143">Unless you have special requirements, avoid client-based authentication.</span></span> <span data-ttu-id="b7e64-144">Этот метод аутентификации не очень надежен.</span><span class="sxs-lookup"><span data-stu-id="b7e64-144">This method of authentication encourages bad practices.</span></span> <span data-ttu-id="b7e64-145">В частности, при аутентификации на основе клиента есть искушение жестко задать учетные данные.</span><span class="sxs-lookup"><span data-stu-id="b7e64-145">In particular, using client-based authentication makes it tempting to hard-code credentials.</span></span> <span data-ttu-id="b7e64-146">Кроме того, пользовательский код для аутентификации может стать нерабочим в последующих выпусках пакета SDK, если изменятся требования к аутентификации.</span><span class="sxs-lookup"><span data-stu-id="b7e64-146">Writing custom code for authentication may also break under future SDK releases if authentication requirements change.</span></span>

## <a name="use-environment-based-authentication"></a><span data-ttu-id="b7e64-147">Использование аутентификации на основе среды</span><span class="sxs-lookup"><span data-stu-id="b7e64-147">Use environment-based authentication</span></span>

<span data-ttu-id="b7e64-148">Если приложение работает в контролируемой среде, аутентификация на основе среды — идеальный вариант.</span><span class="sxs-lookup"><span data-stu-id="b7e64-148">If you're running your application in a controlled setting, environment-based authentication is a natural choice.</span></span> <span data-ttu-id="b7e64-149">С помощью этого метода аутентификации можно настроить среду оболочки перед запуском приложения.</span><span class="sxs-lookup"><span data-stu-id="b7e64-149">With this authentication method, you configure the shell environment before running your application.</span></span> <span data-ttu-id="b7e64-150">Во время выполнения пакет SDK для Go считывает эти переменные среды для аутентификации в Azure.</span><span class="sxs-lookup"><span data-stu-id="b7e64-150">At runtime, the Go SDK reads these environment variables to authenticate with Azure.</span></span>

<span data-ttu-id="b7e64-151">Аутентификация на основе среды поддерживают все методы, за исключением аутентификации на основе маркера устройства. Приоритет определяется в следующем порядке:</span><span class="sxs-lookup"><span data-stu-id="b7e64-151">Environment-based authentication has support for all authentication methods except device tokens, evaluated in the following order:</span></span>

* <span data-ttu-id="b7e64-152">Учетные данные клиента</span><span class="sxs-lookup"><span data-stu-id="b7e64-152">Client credentials</span></span>
* <span data-ttu-id="b7e64-153">Сертификаты X509</span><span class="sxs-lookup"><span data-stu-id="b7e64-153">X509 certificates</span></span>
* <span data-ttu-id="b7e64-154">Имя пользователя или пароль</span><span class="sxs-lookup"><span data-stu-id="b7e64-154">Username/password</span></span>
* <span data-ttu-id="b7e64-155">Управляемые удостоверения для ресурсов Azure</span><span class="sxs-lookup"><span data-stu-id="b7e64-155">Managed identities for Azure resources</span></span>

<span data-ttu-id="b7e64-156">Если значения для типа аутентификации удалены или отклонены, пакет SDK автоматически попытается использовать следующий тип аутентификации.</span><span class="sxs-lookup"><span data-stu-id="b7e64-156">If an authentication type has unset values or is refused, the SDK automatically tries the next authentication type.</span></span> <span data-ttu-id="b7e64-157">Когда будут использованы все типы, пакет SDK вернет ошибку.</span><span class="sxs-lookup"><span data-stu-id="b7e64-157">When no more types are available to try, the SDK returns an error.</span></span>

<span data-ttu-id="b7e64-158">В приведенной ниже таблице указаны переменные среды, которые нужно задать для каждого типа, который поддерживает аутентификация на основе среды.</span><span class="sxs-lookup"><span data-stu-id="b7e64-158">The following table details the environment variables that need to be set for each authentication type supported by environment-based authentication.</span></span>

| <span data-ttu-id="b7e64-159">Authentication type (Тип проверки подлинности)</span><span class="sxs-lookup"><span data-stu-id="b7e64-159">Authentication type</span></span> | <span data-ttu-id="b7e64-160">Переменная среды</span><span class="sxs-lookup"><span data-stu-id="b7e64-160">Environment variable</span></span> | <span data-ttu-id="b7e64-161">ОПИСАНИЕ</span><span class="sxs-lookup"><span data-stu-id="b7e64-161">Description</span></span> |
| ------------------- | -------------------- | ----------- |
| <span data-ttu-id="b7e64-162">__Учетные данные клиента__</span><span class="sxs-lookup"><span data-stu-id="b7e64-162">__Client credentials__</span></span> | `AZURE_TENANT_ID` | <span data-ttu-id="b7e64-163">Идентификатор для клиента Active Directory, к которому относится субъект-служба.</span><span class="sxs-lookup"><span data-stu-id="b7e64-163">The ID for the Active Directory tenant that the service principal belongs to.</span></span> |
| | `AZURE_CLIENT_ID` | <span data-ttu-id="b7e64-164">Имя или идентификатор субъекта-службы.</span><span class="sxs-lookup"><span data-stu-id="b7e64-164">The name or ID of the service principal.</span></span> |
| | `AZURE_CLIENT_SECRET` | <span data-ttu-id="b7e64-165">Секрет, связанный с субъектом-службой.</span><span class="sxs-lookup"><span data-stu-id="b7e64-165">The secret associated with the service principal.</span></span> |
| <span data-ttu-id="b7e64-166">__Certificate__</span><span class="sxs-lookup"><span data-stu-id="b7e64-166">__Certificate__</span></span> | `AZURE_TENANT_ID` | <span data-ttu-id="b7e64-167">Идентификатор клиента Active Directory, в котором зарегистрирован сертификат.</span><span class="sxs-lookup"><span data-stu-id="b7e64-167">The ID for the Active Directory tenant that the certificate is registered with.</span></span> |
| | `AZURE_CLIENT_ID` | <span data-ttu-id="b7e64-168">Идентификатор клиента приложения, связанный с сертификатом.</span><span class="sxs-lookup"><span data-stu-id="b7e64-168">The application client ID associated with the certificate.</span></span> |
| | `AZURE_CERTIFICATE_PATH` | <span data-ttu-id="b7e64-169">Путь к файлу сертификата клиента.</span><span class="sxs-lookup"><span data-stu-id="b7e64-169">The path to the client certificate file.</span></span> |
| | `AZURE_CERTIFICATE_PASSWORD` | <span data-ttu-id="b7e64-170">Пароль для сертификата клиента.</span><span class="sxs-lookup"><span data-stu-id="b7e64-170">The password for the client certificate.</span></span> |
| <span data-ttu-id="b7e64-171">__Имя пользователя или пароль__</span><span class="sxs-lookup"><span data-stu-id="b7e64-171">__Username/Password__</span></span> | `AZURE_TENANT_ID` | <span data-ttu-id="b7e64-172">Идентификатор для клиента Active Directory, к которому относится пользователь.</span><span class="sxs-lookup"><span data-stu-id="b7e64-172">The ID for the Active Directory tenant that the user belongs to.</span></span> |
| | `AZURE_CLIENT_ID` | <span data-ttu-id="b7e64-173">Идентификатор клиента приложения.</span><span class="sxs-lookup"><span data-stu-id="b7e64-173">The application client ID.</span></span> |
| | `AZURE_USERNAME` | <span data-ttu-id="b7e64-174">Имя пользователя для входа в систему.</span><span class="sxs-lookup"><span data-stu-id="b7e64-174">The username to sign in with.</span></span> |
| | `AZURE_PASSWORD` | <span data-ttu-id="b7e64-175">Пароль для входа в систему.</span><span class="sxs-lookup"><span data-stu-id="b7e64-175">The password to sign in with.</span></span> |
| <span data-ttu-id="b7e64-176">__Управляемое удостоверение__</span><span class="sxs-lookup"><span data-stu-id="b7e64-176">__Managed identity__</span></span> | | <span data-ttu-id="b7e64-177">Учетные данные для аутентификации на основе управляемого удостоверения не требуются.</span><span class="sxs-lookup"><span data-stu-id="b7e64-177">No credentials are needed for managed identity authentication.</span></span> <span data-ttu-id="b7e64-178">Приложение должно выполняться в ресурсе Azure, настроенном для использования управляемых удостоверений.</span><span class="sxs-lookup"><span data-stu-id="b7e64-178">The application must be running on an Azure resource configured to use managed identities.</span></span> <span data-ttu-id="b7e64-179">Дополнительные сведения см. в статье [Управляемые удостоверения для ресурсов Azure].</span><span class="sxs-lookup"><span data-stu-id="b7e64-179">For details, see [Managed identities for Azure resources].</span></span> |

<span data-ttu-id="b7e64-180">Чтобы подключиться к облаку или конечной точке управления, отличным от общедоступного облака Azure по умолчанию, можно задать следующие переменные среды.</span><span class="sxs-lookup"><span data-stu-id="b7e64-180">To connect to a cloud or management endpoint other than the default Azure public cloud, set the following environment variables.</span></span> <span data-ttu-id="b7e64-181">Как правило, их задают при использовании Azure Stack, облака, находящегося в другой географической области, или классической модели развертывания.</span><span class="sxs-lookup"><span data-stu-id="b7e64-181">The most common reasons are if you use Azure Stack, a cloud in a different geographic region, or the classic deployment model.</span></span>

| <span data-ttu-id="b7e64-182">Переменная среды</span><span class="sxs-lookup"><span data-stu-id="b7e64-182">Environment variable</span></span> | <span data-ttu-id="b7e64-183">ОПИСАНИЕ</span><span class="sxs-lookup"><span data-stu-id="b7e64-183">Description</span></span>  |
|----------------------|--------------|
| `AZURE_ENVIRONMENT` | <span data-ttu-id="b7e64-184">Имя облачной среды, к которой нужно подключиться.</span><span class="sxs-lookup"><span data-stu-id="b7e64-184">The name of the cloud environment to connect to.</span></span> |
| `AZURE_AD_RESOURCE` | <span data-ttu-id="b7e64-185">Идентификатор ресурса Active Directory, который нужно использовать при подключении, в виде универсального кода ресурса (URI) для точки управления.</span><span class="sxs-lookup"><span data-stu-id="b7e64-185">The Active Directory resource ID to use when connecting, as a URI to your management endpoint.</span></span> |

<span data-ttu-id="b7e64-186">При аутентификации на основе среды вызовите функцию [NewAuthorizerFromEnvironment](https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#NewAuthorizerFromEnvironment), чтобы получить объект авторизации.</span><span class="sxs-lookup"><span data-stu-id="b7e64-186">When using environment-based authentication, call the [NewAuthorizerFromEnvironment](https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#NewAuthorizerFromEnvironment) function to get your authorizer object.</span></span> <span data-ttu-id="b7e64-187">Затем этот объект задается в свойстве `Authorizer` клиентов, чтобы разрешить им доступ к Azure.</span><span class="sxs-lookup"><span data-stu-id="b7e64-187">This object is then set on the `Authorizer` property of clients to allow them access to Azure.</span></span>

```go
import "github.com/Azure/go-autorest/autorest/azure/auth"
authorizer, err := auth.NewAuthorizerFromEnvironment()
```

### <a name="authentication-on-azure-stack"></a><span data-ttu-id="b7e64-188">Аутентификация в Azure Stack</span><span class="sxs-lookup"><span data-stu-id="b7e64-188">Authentication on Azure Stack</span></span>

<span data-ttu-id="b7e64-189">Для аутентификации в Azure Stack нужно задать следующие переменные:</span><span class="sxs-lookup"><span data-stu-id="b7e64-189">To authenticate on Azure Stack, you need to set the following variables:</span></span>

| <span data-ttu-id="b7e64-190">Переменная среды</span><span class="sxs-lookup"><span data-stu-id="b7e64-190">Environment variable</span></span> | <span data-ttu-id="b7e64-191">ОПИСАНИЕ</span><span class="sxs-lookup"><span data-stu-id="b7e64-191">Description</span></span>  |
|----------------------|--------------|
| `AZURE_AD_ENDPOINT` | <span data-ttu-id="b7e64-192">Конечная точка Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="b7e64-192">The Active Directory endpoint.</span></span> |
| `AZURE_AD_RESOURCE` | <span data-ttu-id="b7e64-193">Идентификатор ресурса Active Directory</span><span class="sxs-lookup"><span data-stu-id="b7e64-193">The Active Directory resource ID.</span></span> |

<span data-ttu-id="b7e64-194">Эти переменные можно извлечь из метаданных Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="b7e64-194">These variables can be retrieved from Azure Stack metadata information.</span></span> <span data-ttu-id="b7e64-195">Чтобы получить метаданные, откройте веб-браузер в среде Azure Stack и перейдите по URL-адресу `(ResourceManagerURL)/metadata/endpoints?api-version=1.0`.</span><span class="sxs-lookup"><span data-stu-id="b7e64-195">To retrieve the metadata, open a web browser in your Azure Stack environment and use the url: `(ResourceManagerURL)/metadata/endpoints?api-version=1.0`</span></span>

<span data-ttu-id="b7e64-196">`ResourceManagerURL` зависит от названия региона, имени компьютера и внешнего полного доменного имени (FQDN) для конкретного развертывания Azure Stack:</span><span class="sxs-lookup"><span data-stu-id="b7e64-196">The `ResourceManagerURL` varies based on the region name, machine name, and external fully qualified domain name (FQDN) of your Azure Stack deployment:</span></span>

| <span data-ttu-id="b7e64-197">Среда</span><span class="sxs-lookup"><span data-stu-id="b7e64-197">Environment</span></span> | <span data-ttu-id="b7e64-198">ResourceManagerURL</span><span class="sxs-lookup"><span data-stu-id="b7e64-198">ResourceManagerURL</span></span> |
|----------------------|--------------|
| <span data-ttu-id="b7e64-199">Комплект разработки</span><span class="sxs-lookup"><span data-stu-id="b7e64-199">Development Kit</span></span> | `https://management.local.azurestack.external/` |
| <span data-ttu-id="b7e64-200">Интегрированные системы</span><span class="sxs-lookup"><span data-stu-id="b7e64-200">Integrated Systems</span></span> | `https://management.(region).ext-(machine-name).(FQDN)` |

<span data-ttu-id="b7e64-201">Дополнительные сведения о том, как использовать пакет Azure SDK для Go в Azure Stack, см. в руководстве по [использованию профилей версий API и Go в Azure Stack](https://docs.microsoft.com/azure/azure-stack/user/azure-stack-version-profiles-go).</span><span class="sxs-lookup"><span data-stu-id="b7e64-201">For more information on how to use the Azure SDK for Go on Azure Stack, see [Use API version profiles with Go in Azure Stack](https://docs.microsoft.com/azure/azure-stack/user/azure-stack-version-profiles-go)</span></span>

## <a name="use-file-based-authentication"></a><span data-ttu-id="b7e64-202">Использование аутентификации на основе файла</span><span class="sxs-lookup"><span data-stu-id="b7e64-202">Use file-based authentication</span></span>

<span data-ttu-id="b7e64-203">Аутентификация на основе файлов использует формат файла, создаваемый [Azure CLI](/cli/azure).</span><span class="sxs-lookup"><span data-stu-id="b7e64-203">File-based authentication uses a file format generated by [the Azure CLI](/cli/azure).</span></span> <span data-ttu-id="b7e64-204">Этот файл можно легко создать при создании субъекта-службы с использованием параметра `--sdk-auth`.</span><span class="sxs-lookup"><span data-stu-id="b7e64-204">You can easily create this file when creating a new service principal with the `--sdk-auth` parameter.</span></span> <span data-ttu-id="b7e64-205">Если вы планируете применить аутентификацию на основе файлов, убедитесь, что этот аргумент задан при создании субъекта-службы.</span><span class="sxs-lookup"><span data-stu-id="b7e64-205">If you plan on using file-based authentication, make sure that this argument is provided when creating a service principal.</span></span> <span data-ttu-id="b7e64-206">Так как CLI выводит выходные данные в `stdout`, перенаправьте их в файл.</span><span class="sxs-lookup"><span data-stu-id="b7e64-206">Since the CLI prints output to `stdout`, redirect output to a file.</span></span>

```azurecli
az ad sp create-for-rbac --sdk-auth > azure.auth
```

<span data-ttu-id="b7e64-207">Задайте в переменной среды `AZURE_AUTH_LOCATION` расположение файла авторизации.</span><span class="sxs-lookup"><span data-stu-id="b7e64-207">Set the `AZURE_AUTH_LOCATION` environment variable to where the authorization file is located.</span></span> <span data-ttu-id="b7e64-208">Эта переменная среды считывается приложением, затем содержащиеся в ней учетные данные анализируются.</span><span class="sxs-lookup"><span data-stu-id="b7e64-208">This environment variable is read by the application, and the credentials within it are parsed.</span></span> <span data-ttu-id="b7e64-209">Если вам нужно выбрать файл авторизации во время выполнения, используйте для среды программы функцию [os.Setenv](https://golang.org/pkg/os/#Setenv).</span><span class="sxs-lookup"><span data-stu-id="b7e64-209">If you need to select the authorization file at runtime, manipulate the program's environment using the [os.Setenv](https://golang.org/pkg/os/#Setenv) function.</span></span>

<span data-ttu-id="b7e64-210">Чтобы загрузить данные для аутентификации, вызовите функцию [NewAuthorizerFromFile](https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#NewAuthorizerFromFile).</span><span class="sxs-lookup"><span data-stu-id="b7e64-210">To load the authentication information, call the [NewAuthorizerFromFile](https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#NewAuthorizerFromFile) function.</span></span> <span data-ttu-id="b7e64-211">В отличие от авторизации на основе среды, для авторизации на основе файла требуется конечная точка ресурса.</span><span class="sxs-lookup"><span data-stu-id="b7e64-211">Unlike environment-based authorization, file-based authorization requires a resource endpoint.</span></span>

```go
import "github.com/Azure/go-autorest/autorest/azure/auth"
authorizer, err := NewAuthorizerFromFile(azure.PublicCloud.ResourceManagerEndpoint)
```

<span data-ttu-id="b7e64-212">Дополнительные сведения об использовании субъектов-служб и управлении правами доступа к ним см. в статье [Создание субъекта-службы с помощью Azure CLI].</span><span class="sxs-lookup"><span data-stu-id="b7e64-212">For more on using service principals and managing their access permissions, see [Create a service principal with Azure CLI].</span></span>

## <a name="use-device-token-authentication"></a><span data-ttu-id="b7e64-213">Использование аутентификации на основе маркера устройства</span><span class="sxs-lookup"><span data-stu-id="b7e64-213">Use device token authentication</span></span>

<span data-ttu-id="b7e64-214">Если нужно обеспечить интерактивный вход пользователей, лучший вариант — это аутентификация на основе маркера устройства.</span><span class="sxs-lookup"><span data-stu-id="b7e64-214">If you want users to sign in interactively, the best way is through device token authentication.</span></span> <span data-ttu-id="b7e64-215">В ходе такой аутентификации пользователю передается маркер, который нужно вставить на странице входа на сайте Майкрософт, где выполняется проверка подлинности с использованием учетной записи Azure Active Directory (AAD).</span><span class="sxs-lookup"><span data-stu-id="b7e64-215">This authentication flow passes the user a token to paste into a Microsoft sign-in site, where they then authenticate with an Azure Active Directory (AAD) account.</span></span> <span data-ttu-id="b7e64-216">Этот метод аутентификации поддерживает учетные записи с включенной аутентификацией MFA, в отличие от стандартного метода проверки имени пользователя или пароля.</span><span class="sxs-lookup"><span data-stu-id="b7e64-216">This authentication method supports accounts that have multi-factor authentication enabled, unlike standard username/password authentication.</span></span>

<span data-ttu-id="b7e64-217">Для аутентификации на основе маркера устройства создайте авторизацию [DeviceFlowConfig](https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#DeviceFlowConfig) с использованием функции [NewDeviceFlowConfig](https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#NewDeviceFlowConfig).</span><span class="sxs-lookup"><span data-stu-id="b7e64-217">To use device token authentication, create a [DeviceFlowConfig](https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#DeviceFlowConfig) authorizer with the [NewDeviceFlowConfig](https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#NewDeviceFlowConfig) function.</span></span> <span data-ttu-id="b7e64-218">Чтобы начать аутентификацию, вызовите в полученном объекте [Authorizer](https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#DeviceFlowConfig.Authorizer).</span><span class="sxs-lookup"><span data-stu-id="b7e64-218">Call [Authorizer](https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#DeviceFlowConfig.Authorizer) on the resulting object to start the authentication process.</span></span> <span data-ttu-id="b7e64-219">Аутентификация на основе маркера устройства блокирует выполнение программы до завершения процесса.</span><span class="sxs-lookup"><span data-stu-id="b7e64-219">Device flow authentication blocks program execution until the whole authentication flow is complete.</span></span>

```go
import "github.com/Azure/go-autorest/autorest/azure/auth"
deviceConfig := auth.NewDeviceFlowConfig(applicationID, tenantID)
authorizer, err := deviceConfig.Authorizer()
```

## <a name="use-an-authentication-client"></a><span data-ttu-id="b7e64-220">Использование клиента аутентификации</span><span class="sxs-lookup"><span data-stu-id="b7e64-220">Use an authentication client</span></span>

<span data-ttu-id="b7e64-221">Если вам нужен особый тип аутентификации и требуется, чтобы программа загружала данные для аутентификации, полученные от пользователя, вы можете использовать любой клиент, который соответствует интерфейсу [auth.AuthorizerConfig](https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#AuthorizerConfig).</span><span class="sxs-lookup"><span data-stu-id="b7e64-221">If you require a specific type of authentication and are willing to have your program do the work to load authentication information from the user, you can use any client that conforms to the [auth.AuthorizerConfig](https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#AuthorizerConfig) interface.</span></span> <span data-ttu-id="b7e64-222">Используйте тип, реализующий этот интерфейс, в следующих случаях:</span><span class="sxs-lookup"><span data-stu-id="b7e64-222">Use a type that implements this interface when you:</span></span>

* <span data-ttu-id="b7e64-223">для написания интерактивной программы;</span><span class="sxs-lookup"><span data-stu-id="b7e64-223">Write an interactive program</span></span>
* <span data-ttu-id="b7e64-224">для использования специализированных файлов конфигурации;</span><span class="sxs-lookup"><span data-stu-id="b7e64-224">Use specialized configuration files</span></span>
* <span data-ttu-id="b7e64-225">для настройки требования, которое запрещает использование встроенного метода аутентификации.</span><span class="sxs-lookup"><span data-stu-id="b7e64-225">Have a requirement that prevents using a built-in authentication method</span></span>

> [!WARNING]
> <span data-ttu-id="b7e64-226">Ни в коем случае не следует жестко задавать учетные данные Azure в приложении.</span><span class="sxs-lookup"><span data-stu-id="b7e64-226">Never hard-code Azure credentials into an application.</span></span> <span data-ttu-id="b7e64-227">Если поместить секреты в двоичный файл приложения, злоумышленникам будет проще извлечь их независимо от того, работает ли приложение.</span><span class="sxs-lookup"><span data-stu-id="b7e64-227">Putting secrets into an application binary makes it easier for an attacker to extract them, whether the application is running or not.</span></span> <span data-ttu-id="b7e64-228">Это подвергает опасности все ресурсы Azure, для которых авторизованы учетные данные!</span><span class="sxs-lookup"><span data-stu-id="b7e64-228">This puts all Azure resources the credentials are authorized for at risk!</span></span>

<span data-ttu-id="b7e64-229">В приведенной ниже таблице перечислены типы в пакете SDK, которые соответствуют интерфейсу `AuthorizerConfig`.</span><span class="sxs-lookup"><span data-stu-id="b7e64-229">The following table lists the types in the SDK that conform to the `AuthorizerConfig` interface.</span></span>

| <span data-ttu-id="b7e64-230">Authentication type (Тип проверки подлинности)</span><span class="sxs-lookup"><span data-stu-id="b7e64-230">Authentication type</span></span> | <span data-ttu-id="b7e64-231">Тип авторизации</span><span class="sxs-lookup"><span data-stu-id="b7e64-231">Authorizer type</span></span> |
|---------------------|-----------------------|
| <span data-ttu-id="b7e64-232">Аутентификация на основе сертификата</span><span class="sxs-lookup"><span data-stu-id="b7e64-232">Certificate-based authentication</span></span> | <span data-ttu-id="b7e64-233">[ClientCertificateConfig]</span><span class="sxs-lookup"><span data-stu-id="b7e64-233">[ClientCertificateConfig]</span></span> |
| <span data-ttu-id="b7e64-234">Учетные данные клиента</span><span class="sxs-lookup"><span data-stu-id="b7e64-234">Client credentials</span></span> | <span data-ttu-id="b7e64-235">[ClientCredentialsConfig]</span><span class="sxs-lookup"><span data-stu-id="b7e64-235">[ClientCredentialsConfig]</span></span> |
| <span data-ttu-id="b7e64-236">Управляемые удостоверения для ресурсов Azure</span><span class="sxs-lookup"><span data-stu-id="b7e64-236">Managed identities for Azure resources</span></span> | <span data-ttu-id="b7e64-237">[MSIConfig]</span><span class="sxs-lookup"><span data-stu-id="b7e64-237">[MSIConfig]</span></span> |
| <span data-ttu-id="b7e64-238">Имя пользователя или пароль</span><span class="sxs-lookup"><span data-stu-id="b7e64-238">Username/password</span></span> | <span data-ttu-id="b7e64-239">[UsernamePasswordConfig]</span><span class="sxs-lookup"><span data-stu-id="b7e64-239">[UsernamePasswordConfig]</span></span> |

[ClientCertificateConfig]: https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#ClientCertificateConfig
[ClientCredentialsConfig]: https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#ClientCredentialsConfig
[MSIConfig]: https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#MSIConfig
[DeviceFlowConfig]: https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#DeviceFlowConfig
[UsernamePasswordConfig]: https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#UsernamePasswordConfig

<span data-ttu-id="b7e64-244">Создайте структуру аутентификации с использованием связанной функции `New` и вызовите в полученном объекте `Authorize`, чтобы выполнить аутентификацию.</span><span class="sxs-lookup"><span data-stu-id="b7e64-244">Create an authenticator with its associated `New` function, and then call `Authorize` on the resulting object to authenticate.</span></span> <span data-ttu-id="b7e64-245">Например, для аутентификации на основе сертификатов:</span><span class="sxs-lookup"><span data-stu-id="b7e64-245">For example, to use certificate-based authentication:</span></span>

```go
import "github.com/Azure/go-autorest/autorest/azure/auth"
certificateAuthorizer := auth.NewClientCertificateConfig(certificatePath, certificatePassword, clientID, tenantID)
authorizerToken, err := certificateAuthorizer.Authorize()
```
