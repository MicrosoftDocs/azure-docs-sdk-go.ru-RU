---
title: Аутентификация с помощью пакета Azure SDK для Go
description: Сведения о методах аутентификации, доступных в пакете Azure SDK для Go, и способах их использования.
services: azure
author: sptramer
ms.author: sttramer
manager: carmonm
ms.date: 09/05/2018
ms.topic: conceptual
ms.technology: azure-sdk-go
ms.devlang: go
ms.service: active-directory
ms.component: authentication
ms.openlocfilehash: 28fd4a4c0832ab19dcf52dc549d0ddc0d1eec6f1
ms.sourcegitcommit: 8b9e10b960150dc08f046ab840d6a5627410db29
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/07/2018
ms.locfileid: "44059107"
---
# <a name="authentication-methods-in-the-azure-sdk-for-go"></a>Методы аутентификации в пакете Azure SDK для Go

Пакет Azure SDK для Go предлагает несколько способов аутентификации в Azure. Эти _типы_ аутентификации вызываются с помощью разных _методов_ аутентификации. В этой статье рассматриваются доступные типы и методы, а также способы их определения для вашего приложения.

## <a name="available-authentication-types-and-methods"></a>Доступные типы и методы аутентификации

В пакете Azure SDK для Go предоставляется несколько типов аутентификации с применением разных наборов учетных данных. Для каждого из этих типов используются разные методы аутентификации, определяющие, каким образом пакет SDK принимает эти учетные данные в качестве входных. В приведенной ниже таблице описаны доступные типы аутентификации и ситуации, в которых их рекомендуется использовать в приложении.

| Authentication type (Тип проверки подлинности) | Рекомендуется в следующем случае |
|---------------------|---------------------|
| Аутентификация на основе сертификата | У вас есть сертификат X509, настроенный для пользователя или субъекта-службы Azure Active Directory (AAD). Дополнительные сведения см. в статье [Приступая к работе с аутентификацией на основе сертификата в Azure Active Directory]. |
| Учетные данные клиента | У вас есть субъект-служба, настроенный для этого приложения или класса, к которому оно относится. Дополнительные сведения см. в статье [Создание субъекта-службы с помощью Azure CLI]. |
| Управляемое удостоверение службы (MSI) | Приложение работает в ресурсе Azure, настроенном с помощью функции "Управляемое удостоверение службы" (MSI). Дополнительные сведения см. в статье [Управляемое удостоверение службы (MSI) для ресурсов Azure]. |
| Маркер устройства | Приложение предназначено __только__ для интерактивного использования. Пользователи могут использовать включенную многофакторную проверку подлинности. Пользователям предоставляется доступ к веб-браузеру для входа. Дополнительные сведения см. в разделе об [использовании аутентификации на основе маркера устройства](#use-device-token-authentication).|
| Имя пользователя или пароль | У вас есть интерактивное приложение, в котором нельзя использовать другой метод аутентификации. Для пользователей, которые входят с помощью AAD, не включена многофакторная проверка подлинности. |

> [!IMPORTANT]
> Если используется тип аутентификации, отличный от учетных данных клиента, приложения нужно зарегистрировать в Azure Active Directory. Дополнительные сведения см. в статье [Интеграция приложений с Azure Active Directory](/azure/active-directory/develop/active-directory-integrating-applications).
>
> [!NOTE]
> Если нет особых требований, избегайте проверки пароля или имени пользователя. Если требуется вход на основе учетных данных пользователя, обычно вместо этого можно использовать аутентификацию на основе маркера устройства.

[Приступая к работе с аутентификацией на основе сертификата в Azure Active Directory]: /azure/active-directory/active-directory-certificate-based-authentication-get-started
[Создание субъекта-службы с помощью Azure CLI]: /cli/azure/create-an-azure-service-principal-azure-cli
[Управляемое удостоверение службы (MSI) для ресурсов Azure]: /azure/active-directory/managed-service-identity/overview

Для этих типов аутентификации используются разные методы.

* При [_аутентификации на основе среды_](#use-environment-based-authentication) учетные данные считываются непосредственно из среды программы.
* При [_аутентификации на основе файла_](#use-file-based-authentication) загружается файл, содержащий учетные данные субъекта-службы.
* При [_аутентификации на основе клиента_](#use-an-authentication-client) используется объект в коде. При этом вы отвечаете за предоставление учетных данных во время выполнения программы.
* При [_аутентификации на основе маркера устройства_](#use-device-token-authentication) пользователь должен выполнить интерактивный вход через веб-браузер с использованием маркера.

Все функции и типы аутентификации доступны в пакете `github.com/Azure/go-autorest/autorest/azure/auth`.

> [!NOTE]
> Если нет особых требований, избегайте аутентификации на основе клиента. Этот метод аутентификации не очень надежен. В частности, при аутентификации на основе клиента есть искушение жестко задать учетные данные. Кроме того, пользовательский код для аутентификации может стать нерабочим в последующих выпусках пакета SDK, если изменятся требования к аутентификации.

## <a name="use-environment-based-authentication"></a>Использование аутентификации на основе среды

Если приложение работает в контролируемой среде, аутентификация на основе среды — идеальный вариант. С помощью этого метода аутентификации можно настроить среду оболочки перед запуском приложения. Во время выполнения пакет SDK для Go считывает эти переменные среды для аутентификации в Azure.

Аутентификация на основе среды поддерживают все методы, за исключением аутентификации на основе маркера устройства. Приоритет определяется в следующем порядке:

* Учетные данные клиента
* Сертификаты X509
* Имя пользователя или пароль
* Управляемое удостоверение службы (MSI)

Если значения для типа аутентификации удалены или отклонены, пакет SDK автоматически попытается использовать следующий тип аутентификации. Когда будут использованы все типы, пакет SDK вернет ошибку.

В приведенной ниже таблице указаны переменные среды, которые нужно задать для каждого типа, который поддерживает аутентификация на основе среды.

| Authentication type (Тип проверки подлинности) | Переменная среды | ОПИСАНИЕ |
| ------------------- | -------------------- | ----------- |
| __Учетные данные клиента__ | `AZURE_TENANT_ID` | Идентификатор для клиента Active Directory, к которому относится субъект-служба. |
| | `AZURE_CLIENT_ID` | Имя или идентификатор субъекта-службы. |
| | `AZURE_CLIENT_SECRET` | Секрет, связанный с субъектом-службой. |
| __Certificate__ | `AZURE_TENANT_ID` | Идентификатор клиента Active Directory, в котором зарегистрирован сертификат. |
| | `AZURE_CLIENT_ID` | Идентификатор клиента приложения, связанный с сертификатом. |
| | `AZURE_CERTIFICATE_PATH` | Путь к файлу сертификата клиента. |
| | `AZURE_CERTIFICATE_PASSWORD` | Пароль для сертификата клиента. |
| __Имя пользователя или пароль__ | `AZURE_TENANT_ID` | Идентификатор для клиента Active Directory, к которому относится пользователь. |
| | `AZURE_CLIENT_ID` | Идентификатор клиента приложения. |
| | `AZURE_USERNAME` | Имя пользователя для входа в систему. |
| | `AZURE_PASSWORD` | Пароль для входа в систему. |
| __MSI__ | | Учетные данные для MSI не требуются. Приложение должно выполняться в ресурсе Azure, настроенном для использования MSI. Дополнительные сведения см. в статье [Управляемое удостоверение службы (MSI) для ресурсов Azure]. |

Чтобы подключиться к облаку или конечной точке управления, отличным от общедоступного облака Azure по умолчанию, можно задать следующие переменные среды. Как правило, их задают при использовании Azure Stack, облака, находящегося в другой географической области, или классической модели развертывания.

| Переменная среды | ОПИСАНИЕ  |
|----------------------|--------------|
| `AZURE_ENVIRONMENT` | Имя облачной среды, к которой нужно подключиться. |
| `AZURE_AD_RESOURCE` | Идентификатор ресурса Active Directory, который нужно использовать при подключении, в виде универсального кода ресурса (URI) для точки управления. |

При аутентификации на основе среды вызовите функцию [NewAuthorizerFromEnvironment](https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#NewAuthorizerFromEnvironment), чтобы получить объект авторизации. Затем этот объект задается в свойстве `Authorizer` клиентов, чтобы разрешить им доступ к Azure.

```go
import "github.com/Azure/go-autorest/autorest/azure/auth"
authorizer, err := auth.NewAuthorizerFromEnvironment()
```

### <a name="authentication-on-azure-stack"></a>Аутентификация в Azure Stack

Для аутентификации в Azure Stack нужно задать следующие переменные:

| Переменная среды | ОПИСАНИЕ  |
|----------------------|--------------|
| `AZURE_AD_ENDPOINT` | Конечная точка Azure Active Directory |
| `AZURE_AD_RESOURCE` | Идентификатор ресурса Active Directory |

Эти переменные можно извлечь из метаданных Azure Stack. Чтобы получить метаданные, откройте веб-браузер в среде Azure Stack и перейдите по URL-адресу `(ResourceManagerURL)/metadata/endpoints?api-version=1.0`.

`ResourceManagerURL` зависит от названия региона, имени компьютера и внешнего полного доменного имени (FQDN) для конкретного развертывания Azure Stack:

| Среда | ResourceManagerURL |
|----------------------|--------------|
| Комплект разработки | `https://management.local.azurestack.external/` |
| Интегрированные системы | `https://management.(region).ext-(machine-name).(FQDN)` |

Дополнительные сведения о том, как использовать пакет Azure SDK для Go в Azure Stack, см. в руководстве по [использованию профилей версий API и Go в Azure Stack](https://docs.microsoft.com/azure/azure-stack/user/azure-stack-version-profiles-go).

## <a name="use-file-based-authentication"></a>Использование аутентификации на основе файла

Аутентификация на основе файлов использует формат файла, создаваемый [Azure CLI](/cli/azure). Этот файл можно легко создать при создании субъекта-службы с использованием параметра `--sdk-auth`. Если вы планируете применить аутентификацию на основе файлов, убедитесь, что этот аргумент задан при создании субъекта-службы. Так как CLI выводит выходные данные в `stdout`, перенаправьте их в файл.

```azurecli
az ad sp create-for-rbac --sdk-auth > azure.auth
```

Задайте в переменной среды `AZURE_AUTH_LOCATION` расположение файла авторизации. Эта переменная среды считывается приложением, затем содержащиеся в ней учетные данные анализируются. Если вам нужно выбрать файл авторизации во время выполнения, используйте для среды программы функцию [os.Setenv](https://golang.org/pkg/os/#Setenv).

Чтобы загрузить данные для аутентификации, вызовите функцию [NewAuthorizerFromFile](https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#NewAuthorizerFromFile). В отличие от авторизации на основе среды, для авторизации на основе файла требуется конечная точка ресурса.

```go
import "github.com/Azure/go-autorest/autorest/azure/auth"
authorizer, err := NewAuthorizerFromFile(azure.PublicCloud.ResourceManagerEndpoint)
```

Дополнительные сведения об использовании субъектов-служб и управлении правами доступа к ним см. в статье [Создание субъекта-службы с помощью Azure CLI].

## <a name="use-device-token-authentication"></a>Использование аутентификации на основе маркера устройства

Если нужно обеспечить интерактивный вход пользователей, лучший вариант — это аутентификация на основе маркера устройства. В ходе такой аутентификации пользователю передается маркер, который нужно вставить на странице входа на сайте Майкрософт, где выполняется проверка подлинности с использованием учетной записи Azure Active Directory (AAD). Этот метод аутентификации поддерживает учетные записи с включенной аутентификацией MFA, в отличие от стандартного метода проверки имени пользователя или пароля.

Для аутентификации на основе маркера устройства создайте авторизацию [DeviceFlowConfig](https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#DeviceFlowConfig) с использованием функции [NewDeviceFlowConfig](https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#NewDeviceFlowConfig). Чтобы начать аутентификацию, вызовите в полученном объекте [Authorizer](https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#DeviceFlowConfig.Authorizer). Аутентификация на основе маркера устройства блокирует выполнение программы до завершения процесса.

```go
import "github.com/Azure/go-autorest/autorest/azure/auth"
deviceConfig := auth.NewDeviceFlowConfig(applicationID, tenantID)
authorizer, err := deviceConfig.Authorizer()
```

## <a name="use-an-authentication-client"></a>Использование клиента аутентификации

Если вам нужен особый тип аутентификации и требуется, чтобы программа загружала данные для аутентификации, полученные от пользователя, вы можете использовать любой клиент, который соответствует интерфейсу [auth.AuthorizerConfig](https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#AuthorizerConfig). Используйте тип, реализующий этот интерфейс, в следующих случаях:

* для написания интерактивной программы;
* для использования специализированных файлов конфигурации;
* для настройки требования, которое запрещает использование встроенного метода аутентификации.

> [!WARNING]
> Ни в коем случае не следует жестко задавать учетные данные Azure в приложении. Если поместить секреты в двоичный файл приложения, злоумышленникам будет проще извлечь их независимо от того, работает ли приложение. Это подвергает опасности все ресурсы Azure, для которых авторизованы учетные данные!

В приведенной ниже таблице перечислены типы в пакете SDK, которые соответствуют интерфейсу `AuthorizerConfig`.

| Authentication type (Тип проверки подлинности) | Тип авторизации |
|---------------------|-----------------------|
| Аутентификация на основе сертификата | [ClientCertificateConfig] |
| Учетные данные клиента | [ClientCredentialsConfig] |
| Управляемое удостоверение службы (MSI) | [MSIConfig] |
| Имя пользователя или пароль | [UsernamePasswordConfig] |

[ClientCertificateConfig]: https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#ClientCertificateConfig
[ClientCredentialsConfig]: https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#ClientCredentialsConfig
[MSIConfig]: https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#MSIConfig
[DeviceFlowConfig]: https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#DeviceFlowConfig
[UsernamePasswordConfig]: https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth#UsernamePasswordConfig

Создайте структуру аутентификации с использованием связанной функции `New` и вызовите в полученном объекте `Authorize`, чтобы выполнить аутентификацию. Например, для аутентификации на основе сертификатов:

```go
import "github.com/Azure/go-autorest/autorest/azure/auth"
certificateAuthorizer := auth.NewClientCertificateConfig(certificatePath, certificatePassword, clientID, tenantID)
authorizerToken, err := certificateAuthorizer.Authorize()
```
